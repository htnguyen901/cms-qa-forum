use AttendanceDB
go

CREATE TABLE [dbo].[AspNetRoles] (
    [Id]   NVARCHAR (128) NOT NULL,
    [Name] NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY CLUSTERED ([Id] ASC)
);

CREATE TABLE [dbo].[AspNetUsers] (
    [Id]                   NVARCHAR (128) NOT NULL,
    [Email]                NVARCHAR (256) NULL,
    [EmailConfirmed]       BIT            NOT NULL,
    [PasswordHash]         NVARCHAR (MAX) NULL,
    [SecurityStamp]        NVARCHAR (MAX) NULL,
    [PhoneNumber]          NVARCHAR (MAX) NULL,
    [PhoneNumberConfirmed] BIT            NOT NULL,
    [TwoFactorEnabled]     BIT            NOT NULL,
    [LockoutEndDateUtc]    DATETIME       NULL,
    [LockoutEnabled]       BIT            NOT NULL,
    [AccessFailedCount]    INT            NOT NULL,
    [UserName]             NVARCHAR (256) NOT NULL,
    [FullName]             NVARCHAR (MAX) DEFAULT ('') NOT NULL,
    CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY CLUSTERED ([Id] ASC)
);

GO
CREATE NONCLUSTERED INDEX [EmailIndex]
    ON [dbo].[AspNetUsers]([Email] ASC);


GO
CREATE UNIQUE NONCLUSTERED INDEX [UserNameIndex]
    ON [dbo].[AspNetUsers]([UserName] ASC);


GO
CREATE UNIQUE NONCLUSTERED INDEX [RoleNameIndex]
    ON [dbo].[AspNetRoles]([Name] ASC);

CREATE TABLE [dbo].[AspNetUserClaims] (
    [Id]         INT            IDENTITY (1, 1) NOT NULL,
    [UserId]     NVARCHAR (128) NOT NULL,
    [ClaimType]  NVARCHAR (MAX) NULL,
    [ClaimValue] NVARCHAR (MAX) NULL,
    CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
);


GO
CREATE NONCLUSTERED INDEX [IX_UserId]
    ON [dbo].[AspNetUserClaims]([UserId] ASC);

CREATE TABLE [dbo].[AspNetUserLogins] (
    [LoginProvider] NVARCHAR (128) NOT NULL,
    [ProviderKey]   NVARCHAR (128) NOT NULL,
    [UserId]        NVARCHAR (128) NOT NULL,
    CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY CLUSTERED ([LoginProvider] ASC, [ProviderKey] ASC, [UserId] ASC),
    CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
);


GO
CREATE NONCLUSTERED INDEX [IX_UserId]
    ON [dbo].[AspNetUserLogins]([UserId] ASC);

CREATE TABLE [dbo].[AspNetUserRoles] (
    [UserId] NVARCHAR (128) NOT NULL,
    [RoleId] NVARCHAR (128) NOT NULL,
    CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY CLUSTERED ([UserId] ASC, [RoleId] ASC),
    CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
);


GO
CREATE NONCLUSTERED INDEX [IX_UserId]
    ON [dbo].[AspNetUserRoles]([UserId] ASC);


GO
CREATE NONCLUSTERED INDEX [IX_RoleId]
    ON [dbo].[AspNetUserRoles]([RoleId] ASC);


create table Department(
[DepartmentId] int Identity Primary key,
[DepartmentName] nvarchar(max)
);

create table Category(
[CategoryId] int Identity Primary key,
[CategoryName] nvarchar(max),
);

create table Submission(
[SubmissionId] int Identity Primary key,
[SubmissionName] nvarchar(max),
[SubmissionDescription] nvarchar(max),
[ClosureDate] datetime,
[FinalClosureDate] datetime
);

create table Idea(
[IdeaId] int identity ,
[Title] nvarchar(max),
[Description] nvarchar(max),
[Content] nvarchar(max),
[CreateDate] datetime,
[LastModifiedDate] datetime,
[UserId] nvarchar(128),
[CategoryId] int,
[SubmissionId] int,
 CONSTRAINT [FK_Idea_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ,
 CONSTRAINT [FK_Idea_Category_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [dbo].[Category] ([CategoryId]),
 CONSTRAINT [FK_Idea_Submission_SubmissionId] FOREIGN KEY ([SubmissionId]) REFERENCES [dbo].[Submission] ([SubmissionId]) ,
 CONSTRAINT [PK_Idea] PRIMARY KEY CLUSTERED ([IdeaId] ASC)
)

create table [dbo].[File](
[Id] int Identity Primary key,
[FilePath] nvarchar(max),
[CreateDate] datetime,
[LastModifiedDate] datetime,
[Ideaid] int,
 CONSTRAINT [FK_File_Idea_IdeaId] FOREIGN KEY ([IdeaId]) REFERENCES [dbo].[Idea] ([IdeaId])
)


create table [dbo].[View](
[UserId] nvarchar(128) not null,
[IdeaId] int,
[LastVisitedDate] datetime,
 CONSTRAINT [PK_View] PRIMARY KEY CLUSTERED ([UserId] ASC, [Ideaid] ASC),

 CONSTRAINT [FK_View_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ,
 CONSTRAINT [FK_View_Idea_IdeaId] FOREIGN KEY ([IdeaId]) REFERENCES [dbo].[Idea] ([IdeaId]) 
 )


create table Comment(
[CommentId] int Identity Primary key,
[Content] nvarchar(max),
[CreateDate] datetime,
[LastModifiedDate] datetime,
[UserId] nvarchar(128) not null,
[IdeaId] int,

 CONSTRAINT [FK_Comment_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ,
 CONSTRAINT [FK_Comment_Idea_IdeaId] FOREIGN KEY ([IdeaId]) REFERENCES [dbo].[Idea] ([IdeaId]) 
)

create table Reaction(
[Reaction] int,
[CreateDate] datetime,
[UserId] nvarchar(128) not null,
[IdeaId] int,
 CONSTRAINT [PK_Reaction] PRIMARY KEY CLUSTERED ([UserId] ASC, [Ideaid] ASC),
 CONSTRAINT [FK_Reation_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ,
 CONSTRAINT [FK_Reaction_Idea_IdeaId] FOREIGN KEY ([IdeaId]) REFERENCES [dbo].[Idea] ([IdeaId]) 
);


